{% load static %}
<!doctype html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang=""> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8" lang=""> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9" lang=""> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang=""> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>
    {% block title %}
    {% endblock %}
    </title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="apple-touch-icon" href="apple-touch-icon.png">

  <link rel="stylesheet" href="{% static 'yaksh/css/bootstrap.min.css' %}">
  <link rel="stylesheet" href="{% static 'yaksh/css/custom.css' %}" type="text/css" />
  <link rel="stylesheet" href="{% static 'yaksh/css/animate.min.css' %}" type="text/css" />
  <link rel="stylesheet" href="{% static 'yaksh/css/font-awesome.css' %}" type="text/css" />
  <link rel="stylesheet" href="{% static 'yaksh/css/ontop.css' %}" type="text/css" />


  {% block meta %}
  <meta charset="utf-8">
  <meta name="description" content="">
  <meta name="author" content="">
  {% endblock %}

  {% block css %}
  {% endblock %}

 

  <script language="JavaScript" type="text/javascript" src="{% static 'yaksh/js/popper.min.js' %}"></script>
  <script language="JavaScript" type="text/javascript" src="{% static 'yaksh/js/jquery-3.3.1.min.js' %}"></script>
  <script language="JavaScript" type="text/javascript" src="{% static 'yaksh/js/bootstrap.min.js' %}"></script>
  <script language="JavaScript" type="text/javascript" src="{% static 'yaksh/js/wow.min.js' %}"></script>
 
  <script>
      new WOW().init();
  </script>
  {% block script %}
  {% endblock %}
</head>

<body {% block onload %} {% endblock %} class="yaksh">

  <div id="ontop">
    <div id="state">
      Checking...<img src="{% static 'yaksh/images/check_answer.gif' %}"/>
    </div></div>

    
  
  {% block nav %}
  {% endblock %}

     <div class="base-content">
         <div class="header">
             <h3><center>{% block pagetitle %}{% endblock pagetitle %}</center></h3>
         </div>
         <h4><center>{% block subtitle %}{% endblock %}</center></h4>
         {% block content %}
         {% endblock %}
     </div>
     

  {% block footer %}
  {% endblock %}

</body>
<script>
    sendOtpBtn=document.querySelector('#send-otp');
    loadEventListeners();
    function loadEventListeners(){
    sendOtpBtn.addEventListener('click', sendOtp);}
    function sendOtp(e){

    username = $("#id_username").val().length
    email = $("#id_email").val().length
    password = $("#id_password").val().length
    confirm_password = $("#id_confirm_password").val().length
    first_name = $("#id_first_name").val().length
    last_name = $("#id_last_name").val().length
    country_code = $("#id_country_code").val().length
    phone_number = $("#id_phone_number").val().length

    if(username == 0 ||
        email==0 ||
        password==0 ||
        confirm_password==0 ||
        first_name==0 ||
        last_name==0 ||
        country_code==0 ||
        phone_number==0
    ) {
    alert("Fill all the below fields.");
    return;}

    country_code = $("#id_country_code").val()
    phone_number = $("#id_phone_number").val()
    student_number = "+".concat(country_code.split("-")[1]).concat(phone_number)

    submitData = {'number' : student_number}

    $.post("/letsprepare/send_otp/",
  {
    data: JSON.stringify(submitData)
  },
  function(data){
    key = Object.keys(data)[0]
    value = Object.values(data)[0]
    if (key == "SENT"){

    if ($.trim($("#send-otp").text()) == "Resend OTP"){
      $("#send-otp").attr("style", "visibility: hidden")
    }
    if ($.trim($("#send-otp").text()) ==  "Get OTP"){
      $("#send-otp").text("Resend OTP");
    }

        var i = 2;
        while(i > 0) {
            var otp = window. prompt("Please enter OTP sent to your mobile number: ");
            if(value == otp) {
               i = -1
               $("#submit-form").click();
            }
            else {
            alert("Incorrect OTP!!");
                i = i-1;

            if (i==0 && $("#send-otp").css("visibility")=="hidden"){
            window.location.href = "/";
            }
        }
    }}
    else {
    alert("Please enter a valid mobile number.");}
  });

}
</script>
</html>

